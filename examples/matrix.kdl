// Matrix build example: pipeline-level + step-level matrix.
//
// Pipeline-level matrix (os) is correlated across steps:
//   build[os=linux] -> test[os=linux], build[os=darwin] -> test[os=darwin]
//
// Step-level matrix (go-version) is independent:
//   Each test step expands into variants per Go version.
//
// Total: 2 build steps + 4 test steps.

pipeline "matrix-ci" {
    matrix {
        os "linux" "darwin"
    }

    step "build" {
        image "golang:1.23"
        run "echo building for GOOS=${matrix.os} && go version"
    }

    step "test" {
        matrix {
            go-version "1.22" "1.23"
        }
        depends-on "build"
        image "golang:${matrix.go-version}"
        run "echo testing on GOOS=${matrix.os} with $(go version)"
    }
}
